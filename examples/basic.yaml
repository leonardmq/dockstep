version: "1.0"
name: "basic-example"

settings: {}

blocks:
  - id: "base"
    from: "alpine:latest"
    instructions:
      - "RUN echo 'Setting up base environment'"
      - "RUN apk add --no-cache bash curl git"

  - id: "deps"
    from_block: "base"
    instructions:
      - "WORKDIR /app"
      - "ENV NODE_ENV=production"
      - "RUN echo 'Installing dependencies'"
      - "RUN apk add --no-cache nodejs npm"
      - "RUN npm install -g typescript"

  - id: "app"
    from_block: "deps"
    instructions:
      - "WORKDIR /app"
      - "ENV NODE_ENV=production"
      - "ENV PORT=3000"
      - "RUN echo 'Setting up application'"
      - "RUN mkdir -p /app/src"
      - "RUN echo 'console.log(\"Hello from dockstep!\");' > /app/src/index.js"
    export:
      labels:
        maintainer: "dockstep"
        version: "1.0.0"
      entrypoint: ["node"]
      cmd: ["/app/src/index.js"]
